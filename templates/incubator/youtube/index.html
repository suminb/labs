{% extends 'base.html' %}
{% block title %} Labs :: YouTube Downloader {% endblock %}
{% block javascript %}
	<script type="text/javascript" src="/static/jquery.js"></script>
	<script type="text/javascript" src="/static/jquery.printf.js"></script>
	<script type="text/javascript">
		var exampleFlag = 1;
		function clearExample() {
			if(exampleFlag != 0) {
				$('#url').val('').removeClass('example');
				exampleFlag = 0;
			}
		}
		
		function download() {
			var console = $('#console');
			console.text('')
			console.removeClass('error');
			
			fmts = new Object();
			fmts['34'] = 'Standard';
			fmts['18'] = 'Medium';
			fmts['35'] = 'High';
			fmts['22'] = '720p';
			fmts['37'] = '1080p';
			fmts['17'] = 'Mobile';
			
			$.post('/incubator/youtube/getinfo',
				{'url':exampleFlag ? '' : $('#url').val()},
				function(json) {
					console.removeClass('hidden');
					if(json.status == 'ok') {
						var res = json.results;

						console.append($.sprintf('<h3>%s</h3>', res.title));
						console.append($.sprintf('<p>%s</p>', res.description));
						console.append('Download: ');
						
						for(var i in res.fmt_url_map) {
							r = res.fmt_url_map[i];
							fmt = r[0];
							url = r[1];
	
							if(fmt in fmts) {
								console.append($.sprintf('<a href="%s">%s</a> ', url, fmts[fmt]));
							}
						}
					}
					else {
						console.text(json.message);
						console.addClass('error');
					}
			}, "json");

			return false;
		}
	</script>
{% endblock %}

{% block content %}
	<h1>YouTube Downloader</h1>
	<form method="post" onsubmit="return download()">
		<input id="url" type="text" value="http://www.youtube.com/watch?v=XXXXXXXX"
			class="example" style="width:400px;" onfocus="clearExample()" onchange="clearExample()"/>
		<input type="submit" value="Download"/>
	</form>
	<div id="console" class="result hidden"></div>
{% endblock %}
